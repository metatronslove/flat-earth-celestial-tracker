<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Düz Dünya Göksel Takip Sistemi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="astronomy.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-hijri/2.1.2/moment-hijri.min.js"></script>
    <style>
        :root {
            --primary: #4fc3f7;
            --secondary: #9c27b0;
            --accent: #ffb300;
            --background: #0c0f2d;
            --card-bg: rgba(13, 19, 33, 0.9);
            --text: #e0f7fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--background), #1a1c45, #2a1b5e);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 25px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            background: rgba(12, 15, 45, 0.7);
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, var(--accent), #ff9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            text-shadow: 0 0 15px rgba(255, 179, 0, 0.3);
        }

        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .model-explanation {
            background: rgba(25, 30, 70, 0.7);
            border-radius: 12px;
            padding: 15px 20px;
            margin: 25px auto;
            max-width: 900px;
            font-size: 1.05rem;
            border: 1px solid rgba(79, 195, 247, 0.3);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(79, 195, 247, 0.3);
            backdrop-filter: blur(8px);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .output-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(156, 39, 176, 0.4);
            backdrop-filter: blur(8px);
        }

        .section-title {
            font-size: 1.7rem;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(79, 195, 247, 0.2);
        }

        .section-title i {
            font-size: 1.9rem;
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.15rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #3949ab;
            background: rgba(25, 35, 70, 0.7);
            color: var(--text);
            font-size: 1.1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(79, 195, 247, 0.4);
            background: rgba(35, 45, 90, 0.7);
        }

        .date-type-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
        }

        .date-type-btn {
            flex: 1;
            padding: 16px;
            text-align: center;
            background: rgba(57, 73, 171, 0.4);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            font-weight: 600;
            font-size: 1.05rem;
        }

        .date-type-btn.active {
            background: rgba(79, 195, 247, 0.3);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 12px rgba(79, 195, 247, 0.3);
        }

        .time-slider-container {
            margin: 35px 0;
            background: rgba(25, 35, 70, 0.7);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(156, 39, 176, 0.4);
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
        }

        .time-slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .time-slider {
            width: 100%;
            height: 20px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #1a237e, #4a148c, #6a1b9a);
            border-radius: 10px;
            outline: none;
            box-shadow: 0 0 12px rgba(156, 39, 176, 0.4);
        }

        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 179, 0, 0.9);
            border: 3px solid #ff9800;
            transition: transform 0.2s;
        }

        .time-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }

        .day-night-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            font-size: 1.15rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .day-segment, .night-segment {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .segment-label {
            font-size: 1.05rem;
            opacity: 0.85;
        }

        .segment-value {
            font-weight: bold;
            color: var(--accent);
            font-size: 1.4rem;
            min-width: 50px;
            text-align: center;
        }

        .celestial-display {
            position: relative;
            height: 500px;
            background: radial-gradient(circle at center, #1a237e 0%, #0c0f2d 85%);
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0;
            border: 1px solid rgba(79, 195, 247, 0.4);
            box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.9);
        }

        .horizon-line {
            position: absolute;
            bottom: 30%;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--primary), transparent);
            box-shadow: 0 0 15px rgba(129, 212, 250, 0.7);
        }

        .compass {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--primary);
            font-size: 1.3rem;
            text-shadow: 0 0 8px rgba(129, 212, 250, 0.9);
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(129, 212, 250, 0.3);
        }

        .flat-earth-model {
            position: absolute;
            bottom: 15px;
            left: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .celestial-body {
            position: absolute;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px currentColor;
            z-index: 10;
            transition: all 0.5s ease;
            cursor: pointer;
        }

        .celestial-body:hover {
            transform: translate(-50%, -50%) scale(1.4);
            z-index: 20;
            box-shadow: 0 0 30px currentColor;
        }

        .celestial-info {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 18px;
            border-radius: 12px;
            font-size: 1.05rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            min-width: 220px;
            z-index: 30;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            line-height: 1.7;
        }

        .celestial-info strong {
            color: var(--primary);
            font-size: 1.2rem;
            display: block;
            margin-bottom: 5px;
        }

        .celestial-body:hover .celestial-info {
            opacity: 1;
        }

        .celestial-table-container {
            overflow-x: auto;
        }

        .celestial-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 1.1rem;
            min-width: 800px;
        }

        .celestial-table th {
            background: rgba(79, 195, 247, 0.3);
            padding: 16px;
            text-align: left;
            color: var(--primary);
            font-weight: 600;
        }

        .celestial-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .celestial-table tr:last-child td {
            border-bottom: none;
        }

        .celestial-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.07);
        }

        .celestial-table tr:hover {
            background: rgba(79, 195, 247, 0.2);
        }

        .celestial-table .lilith-row {
            background: rgba(156, 39, 176, 0.2);
        }

        .celestial-table .lilith-row:hover {
            background: rgba(156, 39, 176, 0.3);
        }

        .celestial-table .fixed-star-row {
            background: rgba(255, 179, 0, 0.1);
        }

        .celestial-table .fixed-star-row:hover {
            background: rgba(255, 179, 0, 0.2);
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border-radius: 12px;
            border: none;
            font-size: 1.15rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), #29b6f6);
            color: #0c1445;
        }

        .btn-secondary {
            background: linear-gradient(to right, var(--secondary), #7b1fa2);
            color: #e1bee7;
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .btn:active {
            transform: translateY(-2px);
        }

        .btn i {
            font-size: 1.3rem;
        }

        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            background: rgba(13, 19, 33, 0.8);
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: var(--primary);
            font-size: 1.5rem;
            gap: 20px;
        }

        .loading-spinner {
            border: 5px solid rgba(79, 195, 247, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--primary);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-circle"></i> Düz Dünya Geocentric Göksel Takip Sistemi</h1>
            <p class="subtitle">Küresel koordinatlar, düz dünya modeli ve İslami okült bilgiler ışığında gök cisimlerinin konumlarını hesaplayan gelişmiş astrolojik araç</p>

            <div class="model-explanation">
                <i class="fas fa-info-circle"></i> <strong>Sistem Bilgisi:</strong> Bu araç, dünya merkezli (geocentric) düz dünya modeline göre tasarlanmıştır. Tüm hesaplamalar gök cisimlerinin dünya üzerindeki kubbe içinde hareket ettiği varsayımıyla yapılmaktadır.
            </div>
        </header>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title"><i class="fas fa-globe-asia"></i> Konum ve Zaman</h2>

                <div class="input-group">
                    <label for="latitude"><i class="fas fa-location-dot"></i> Enlem (Latitude)</label>
                    <input type="text" id="latitude" value="41.0082" placeholder="Ör: 41.0082">
                </div>

                <div class="input-group">
                    <label for="longitude"><i class="fas fa-location-dot"></i> Boylam (Longitude)</label>
                    <input type="text" id="longitude" value="28.9784" placeholder="Ör: 28.9784">
                </div>

                <div class="input-group">
                    <label><i class="fas fa-city"></i> Şehir Seçin</label>
                    <select id="city-select"></select>
                </div>

                <div class="input-group">
                    <label><i class="fas fa-calendar"></i> Takvim Sistemi</label>
                    <div class="date-type-selector">
                        <div class="date-type-btn active" id="gregorian-btn">Miladi Takvim</div>
                        <div class="date-type-btn" id="hijri-btn">Hicri Takvim</div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="date"><i class="fas fa-calendar-days"></i> Tarih</label>
                    <input type="date" id="date" value="2023-10-15">
                </div>

                <div class="input-group">
                    <label for="time"><i class="fas fa-clock"></i> Saat (24 saat formatında)</label>
                    <input type="time" id="time" value="21:30">
                </div>

                <div class="actions">
                    <button class="btn btn-primary" id="calculate-btn">
                        <i class="fas fa-calculator"></i> Gök Cisimlerini Hesapla
                    </button>
                    <button class="btn btn-secondary" id="reset-btn">
                        <i class="fas fa-redo"></i> Varsayılanlara Dön
                    </button>
                </div>
            </div>

            <div class="output-section">
                <h2 class="section-title"><i class="fas fa-stars"></i> Göksel Konumlar ve Analizler</h2>

                <div class="time-slider-container">
                    <div class="time-slider-header">
                        <span><i class="fas fa-sliders"></i> Gün İçi Zaman Kaydırıcı</span>
                        <span id="current-time-display">21:30</span>
                    </div>
                    <input type="range" min="0" max="86400" value="77400" class="time-slider" id="time-slider">

                    <div class="day-night-indicator">
                        <div class="day-segment">
                            <span class="segment-label">Gündüz Dilimi</span>
                            <span class="segment-value">-</span>
                        </div>
                        <div class="night-segment">
                            <span class="segment-label">Gece Dilimi</span>
                            <span class="segment-value">4. Dilim</span>
                        </div>
                    </div>
                </div>

                <div class="celestial-display" id="celestial-display">
                    <div class="horizon-line"></div>
                    <div class="compass">Kuzey ↑</div>
                    <div class="flat-earth-model">Düz Dünya Modeli - Geocentric Sistem</div>
                </div>

                <div class="celestial-table-container">
                    <table class="celestial-table">
                        <thead>
                            <tr>
                                <th>Gök Cismi</th>
                                <th>Durum</th>
                                <th>Yükseklik</th>
                                <th>Açı</th>
                                <th>Doğuş</th>
                                <th>Batış</th>
                                <th>Mesafe (AU)</th>
                                <th>Parlaklık</th>
                            </tr>
                        </thead>
                        <tbody id="celestial-data">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Bu proje, düz dünya (geocentric) modeli temelinde gök cisimlerinin konumlarını hesaplamak için geliştirilmiştir | Kubbe altında güneş, ay ve yıldızlar modeli kullanılmaktadır</p>
            <p>© 2023 Geocentric Celestial Tracker | İslami Okült Çalışmalar ve Astroloji için Geliştirilmiştir</p>
        </div>
    </div>

    <script>
        // Şehir verileri
        const cities = [
            {name: "İstanbul", lat: 41.0082, lon: 28.9784},
            {name: "Ankara", lat: 39.9334, lon: 32.8597},
            {name: "İzmir", lat: 38.4237, lon: 27.1428},
            {name: "Bursa", lat: 40.1826, lon: 29.0669},
            {name: "Adana", lat: 37.0000, lon: 35.3213},
            {name: "Gaziantep", lat: 37.0660, lon: 37.3781},
            {name: "Konya", lat: 37.8714, lon: 32.4846},
            {name: "Antalya", lat: 36.8969, lon: 30.7133},
            {name: "Diyarbakır", lat: 37.9100, lon: 40.2306},
            {name: "Mersin", lat: 36.8000, lon: 34.6333},
            {name: "Kayseri", lat: 38.7333, lon: 35.4833},
            {name: "Eskişehir", lat: 39.7767, lon: 30.5206},
            {name: "Samsun", lat: 41.2867, lon: 36.33},
            {name: "Denizli", lat: 37.7833, lon: 29.1000},
            {name: "Şanlıurfa", lat: 37.1674, lon: 38.7959},
            {name: "Malatya", lat: 38.3554, lon: 38.3337},
            {name: "Kahramanmaraş", lat: 37.5833, lon: 36.9333},
            {name: "Erzurum", lat: 39.9000, lon: 41.2700},
            {name: "Van", lat: 38.4942, lon: 43.3800},
            {name: "Batman", lat: 37.8833, lon: 41.1333},
            {name: "Elazığ", lat: 38.6667, lon: 39.2167},
            {name: "Sivas", lat: 39.7500, lon: 37.0167},
            {name: "Trabzon", lat: 41.0015, lon: 39.7178},
            {name: "Manisa", lat: 38.6333, lon: 27.4167},
            {name: "Balıkesir", lat: 39.6500, lon: 27.8833},
            {name: "Adıyaman", lat: 37.7194, lon: 38.3111},
            {name: "Aydın", lat: 37.8500, lon: 27.8500},
            {name: "Muğla", lat: 37.2167, lon: 28.3667},
            {name: "Tekirdağ", lat: 40.9833, lon: 27.5167},
            {name: "Çanakkale", lat: 40.1553, lon: 26.4142},
            {name: "Edirne", lat: 41.6667, lon: 26.5667},
            {name: "Kırklareli", lat: 41.7333, lon: 27.2167},
            {name: "Isparta", lat: 37.7667, lon: 30.5500},
            {name: "Burdur", lat: 37.7167, lon: 30.2833},
            {name: "Afyonkarahisar", lat: 38.7500, lon: 30.5500},
            {name: "Uşak", lat: 38.6833, lon: 29.4000},
            {name: "Niğde", lat: 37.9667, lon: 34.6833},
            {name: "Nevşehir", lat: 38.6333, lon: 34.7167},
            {name: "Kırşehir", lat: 39.1500, lon: 34.1667},
            {name: "Aksaray", lat: 38.3667, lon: 34.0333},
            {name: "Kırıkkale", lat: 39.8500, lon: 33.5167},
            {name: "Çankırı", lat: 40.6000, lon: 33.6167},
            {name: "Karabük", lat: 41.2000, lon: 32.6333},
            {name: "Zonguldak", lat: 41.4500, lon: 31.7833},
            {name: "Bolu", lat: 40.7333, lon: 31.6000},
            {name: "Düzce", lat: 40.8333, lon: 31.1667},
            {name: "Sakarya", lat: 40.7833, lon: 30.4000},
            {name: "Yalova", lat: 40.6500, lon: 29.2667},
            {name: "Bilecik", lat: 40.1500, lon: 29.9833},
            {name: "Rize", lat: 41.0208, lon: 40.5219},
            {name: "Artvin", lat: 41.1833, lon: 41.8167},
            {name: "Giresun", lat: 40.9167, lon: 38.4000},
            {name: "Gümüşhane", lat: 40.4667, lon: 39.4833},
            {name: "Ordu", lat: 40.9833, lon: 37.8833},
            {name: "Sinop", lat: 42.0267, lon: 35.1556},
            {name: "Kastamonu", lat: 41.3833, lon: 33.7833},
            {name: "Çorum", lat: 40.5500, lon: 34.9500},
            {name: "Amasya", lat: 40.6500, lon: 35.8333},
            {name: "Tokat", lat: 40.3167, lon: 36.5500},
            {name: "Yozgat", lat: 39.8167, lon: 34.8000},
            {name: "Osmaniye", lat: 37.0750, lon: 36.2500},
            {name: "Hatay", lat: 36.2000, lon: 36.1667},
            {name: "K.Maraş", lat: 37.5833, lon: 36.9333},
            {name: "Mardin", lat: 37.3167, lon: 40.7333},
            {name: "Şırnak", lat: 37.5167, lon: 42.4500},
            {name: "Siirt", lat: 37.9333, lon: 41.9500},
            {name: "Hakkari", lat: 37.5833, lon: 43.7333},
            {name: "Bitlis", lat: 38.4000, lon: 42.1000},
            {name: "Muş", lat: 38.7333, lon: 41.4833},
            {name: "Bingöl", lat: 38.8833, lon: 40.5000},
            {name: "Tunceli", lat: 39.1000, lon: 39.5500},
            {name: "Erzincan", lat: 39.7500, lon: 39.5000},
            {name: "Ardahan", lat: 41.1167, lon: 42.7000},
            {name: "Kars", lat: 40.6000, lon: 43.1000},
            {name: "Iğdır", lat: 39.9167, lon: 44.0333},
            {name: "Ağrı", lat: 39.7167, lon: 43.0500},
            {name: "New York", lat: 40.7128, lon: -74.0060},
            {name: "Londra", lat: 51.5074, lon: -0.1278},
            {name: "Paris", lat: 48.8566, lon: 2.3522},
            {name: "Tokyo", lat: 35.6762, lon: 139.6503},
            {name: "Pekin", lat: 39.9042, lon: 116.4074},
            {name: "Moskova", lat: 55.7558, lon: 37.6173},
            {name: "Yeni Delhi", lat: 28.6139, lon: 77.2090},
            {name: "Kahire", lat: 30.0444, lon: 31.2357},
            {name: "Riyad", lat: 24.7136, lon: 46.6753},
            {name: "Dubai", lat: 25.2048, lon: 55.2708},
            {name: "İslamabad", lat: 33.6844, lon: 73.0479},
            {name: "Bakü", lat: 40.4093, lon: 49.8671},
            {name: "Tahran", lat: 35.6892, lon: 51.3890},
            {name: "Kudüs", lat: 31.7683, lon: 35.2137}
        ];

        // Gök cisimleri verileri - Astronomy.js ile uyumlu
        const celestialBodies = [
            {id: 'Sun', name: 'Güneş (Şems)', color: '#FFB300', size: 40, symbol: 'sun', type: 'star'},
            {id: 'Moon', name: 'Ay (Kamer)', color: '#E0E0E0', size: 30, symbol: 'moon', type: 'star'},
            {id: 'Mercury', name: 'Merkür (Utarid)', color: '#4FC3F7', size: 12, symbol: 'star', type: 'planet'},
            {id: 'Venus', name: 'Venüs (Zühre)', color: '#FF9800', size: 18, symbol: 'star', type: 'planet'},
            {id: 'Mars', name: 'Mars (Merih)', color: '#F44336', size: 16, symbol: 'star', type: 'planet'},
            {id: 'Jupiter', name: 'Jüpiter (Müşteri)', color: '#795548', size: 25, symbol: 'star', type: 'planet'},
            {id: 'Saturn', name: 'Satürn (Zühal)', color: '#FFC107', size: 22, symbol: 'star', type: 'planet'},
            {id: 'Uranus', name: 'Uranus', color: '#4CAF50', size: 20, symbol: 'star', type: 'planet'},
            {id: 'Neptune', name: 'Neptün', color: '#2196F3', size: 20, symbol: 'star', type: 'planet'},
            {id: 'Pluto', name: 'Pluto', color: '#9C27B0', size: 15, symbol: 'star', type: 'planet'}
        ];

        // Sabit yıldızların koordinatları (J2000.0 epoch)
        const fixedStars = [
            {id: 'Aldebaran', name: 'Aldebaran (Dübbü\'l-Esgar)', color: '#FF5722', size: 8, ra: 4.598, dec: 16.51},
            {id: 'Regulus', name: 'Regulus (Kalbu\'l-Esed)', color: '#3F51B5', size: 8, ra: 10.139, dec: 11.97},
            {id: 'Spica', name: 'Spica (Sünbüle)', color: '#4DB6AC', size: 8, ra: 13.42, dec: -11.16},
            {id: 'Antares', name: 'Antares (Kalbu\'l-Akrep)', color: '#E91E63', size: 8, ra: 16.49, dec: -26.43},
            {id: 'Sirius', name: 'Sirius (Şi\'ra)', color: '#00BCD4', size: 10, ra: 6.75, dec: -16.72},
            {id: 'Polaris', name: 'Polaris (Kutup Yıldızı)', color: '#9E9E9E', size: 8, ra: 2.53, dec: 89.26},
            {id: 'Vega', name: 'Vega (Nesrü\'l-Vaki)', color: '#8BC34A', size: 8, ra: 18.62, dec: 38.78},
            {id: 'Rigel', name: 'Rigel (Riclü\'l-Cevze)', color: '#03A9F4', size: 8, ra: 5.24, dec: -8.20},
            {id: 'Betelgeuse', name: 'Betelgeuse (Mankibü\'l-Cevze)', color: '#FF5252', size: 9, ra: 5.92, dec: 7.41},
            {id: 'Canopus', name: 'Canopus (Suhayl)', color: '#FFD740', size: 9, ra: 6.40, dec: -52.70},
            {id: 'Arcturus', name: 'Arcturus (Simakü\'l-Ramih)', color: '#FF6D00', size: 8, ra: 14.26, dec: 19.18},
            {id: 'Capella', name: 'Capella (Ayyuk)', color: '#FFEA00', size: 8, ra: 5.28, dec: 45.99}
        ];


		// Ay evreleri için fonksiyon
		function getMoonPhase(date) {
			const phase = Astronomy.MoonPhase(date);
			let phaseName;
			let icon;

			if (phase < 0.03 || phase > 0.97) {
				phaseName = "Yeni Ay";
				icon = "moon";
			} else if (phase < 0.22) {
				phaseName = "Hilal";
				icon = "moon";
			} else if (phase < 0.28) {
				phaseName = "İlk Dördün";
				icon = "moon";
			} else if (phase < 0.47) {
				phaseName = "Şişkin Ay";
				icon = "moon";
			} else if (phase < 0.53) {
				phaseName = "Dolunay";
				icon = "moon";
			} else if (phase < 0.72) {
				phaseName = "Şişkin Ay";
				icon = "moon";
			} else if (phase < 0.78) {
				phaseName = "Son Dördün";
				icon = "moon";
			} else {
				phaseName = "Hilal";
				icon = "moon";
			}

			return { name: phaseName, icon: icon, value: phase };
		}

        const CelestialTracker = {
            init() {
                this.initCityDropdown();
                this.setCurrentDateTime();
                this.setCurrentLocation();
                this.bindEvents();
                this.createCelestialTable();
                createCelestialBodies();
                this.updateAll();
            },

            initCityDropdown() {
                const citySelect = document.getElementById('city-select');
                if (!citySelect) {
                    console.error("city-select elementi bulunamadı!");
                    return;
                }

                citySelect.innerHTML = '';
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = `${city.lat},${city.lon}`;
                    option.textContent = city.name;
                    citySelect.appendChild(option);
                });
            },

            setCurrentDateTime() {
                const now = new Date();
                document.getElementById('date').value = now.toISOString().split('T')[0];
                document.getElementById('time').value =
                    `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                document.getElementById('time-slider').value = now.getHours() * 3600 + now.getMinutes() * 60;
            },

            setCurrentLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const lat = position.coords.latitude.toFixed(4);
                            const lon = position.coords.longitude.toFixed(4);
                            document.getElementById('latitude').value = lat;
                            document.getElementById('longitude').value = lon;
                        },
                        () => {
                            document.getElementById('latitude').value = "41.0082";
                            document.getElementById('longitude').value = "28.9784";
                        }
                    );
                }
            },

            bindEvents() {
                document.getElementById('city-select').addEventListener('change', (e) => {
                    const [lat, lon] = e.target.value.split(',');
                    document.getElementById('latitude').value = lat;
                    document.getElementById('longitude').value = lon;
                    this.updateAll();
                });

                document.getElementById('calculate-btn').addEventListener('click', () => this.updateAll());
                document.getElementById('reset-btn').addEventListener('click', () => this.resetToDefaults());
                document.getElementById('time-slider').addEventListener('input', () => this.updateTimeFromSlider());

                // Takvim sistemi değiştirme
                document.getElementById('gregorian-btn').addEventListener('click', () => this.switchCalendar('gregorian'));
                document.getElementById('hijri-btn').addEventListener('click', () => this.switchCalendar('hijri'));
            },

            switchCalendar(type) {
                document.querySelectorAll('.date-type-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`${type}-btn`).classList.add('active');

                if (type === 'hijri') {
                    // Hicri takvim için özel işlemler
                    const now = moment();
                    const hijriDate = now.format('iYYYY-iMM-iDD');
                    document.getElementById('date').value = hijriDate;
                } else {
                    // Miladi takvim
                    const now = new Date();
                    document.getElementById('date').value = now.toISOString().split('T')[0];
                }
            },

            resetToDefaults() {
                document.getElementById('latitude').value = "41.0082";
                document.getElementById('longitude').value = "28.9784";
                this.setCurrentDateTime();
                this.updateAll();
            },

            createCelestialTable() {
                const tableBody = document.getElementById('celestial-data');
                tableBody.innerHTML = '';

                // Gezegenler
                celestialBodies.forEach(body => {
                    const row = document.createElement('tr');
                    if (body.type === 'planet') {
                        row.className = 'planet-row';
                    }

                    row.setAttribute('data-body-id', body.id);

                    row.innerHTML = `
                        <td><i class="fas fa-${body.symbol}" style="color: ${body.color}"></i> ${body.name}</td>
                        <td class="status">-</td>
                        <td class="altitude">-</td>
                        <td class="azimuth">-</td>
                        <td class="rise-time">-</td>
                        <td class="set-time">-</td>
                        <td class="distance">-</td>
                        <td class="magnitude">-</td>
                    `;
                    tableBody.appendChild(row);
                });

                // Sabit yıldızlar
                fixedStars.forEach(star => {
                    const row = document.createElement('tr');
                    row.className = 'fixed-star-row';
                    row.setAttribute('data-body-id', star.id);

                    row.innerHTML = `
                        <td><i class="fas fa-star" style="color: ${star.color}"></i> ${star.name}</td>
                        <td class="status">-</td>
                        <td class="altitude">-</td>
                        <td class="azimuth">-</td>
                        <td class="rise-time">-</td>
                        <td class="set-time">-</td>
                        <td class="distance">Sabit</td>
                        <td class="magnitude">-</td>
                    `;
                    tableBody.appendChild(row);
                });
            },

			calculatePosition(bodyId, date, time, lat, lon) {
				try {
					const datetime = new Date(`${date}T${time}Z`);
					const observer = new Astronomy.Observer(lat, lon, 0);

					// 1. Astronomy Engine ile doğrudan desteklenen cisimler
					if (celestialBodies[bodyId]) {
						const body = celestialBodies[bodyId];
						const {ra, dec} = Astronomy.Equator(body, datetime, observer, true, true);
						const {altitude, azimuth} = Astronomy.Horizon(datetime, observer, ra, dec, 'normal');

						// Ay için ekstra bilgiler
						let moonInfo = {};
						if (bodyId === 'moon') {
							const phase = getMoonPhase(datetime);
							moonInfo = {
								phase: phase.name,
								phaseIcon: phase.icon,
								phaseValue: phase.value
							};
						}

						return {
							altitude,
							azimuth,
							rise: this.calculateRiseSet(body, observer, datetime, +1),
							set: this.calculateRiseSet(body, observer, datetime, -1),
							distance: Astronomy.AstrometricDistance(body, datetime),
							...moonInfo
						};
					}
					// 2. Sabit yıldızlar için
					else {
						const star = fixedStars.find(s => s.id === bodyId);
						if (star) {
							const {altitude, azimuth} = Astronomy.Horizon(datetime, observer, star.ra, star.dec, 'normal');
							return {
								altitude,
								azimuth,
								rise: '-', // Sabit yıldızlar için farklı hesaplama gerekir
								set: '-',
								distance: null
							};
						}
					}

					return null;
				} catch (e) {
					console.error(`Hesaplama hatası (${bodyId}):`, e);
					return null;
				}
			},

			// Tabloyu güncelleme fonksiyonu
            updateCelestialTable() {
                const date = document.getElementById('date').value;
                const time = document.getElementById('time').value;
                const lat = parseFloat(document.getElementById('latitude').value);
                const lon = parseFloat(document.getElementById('longitude').value);
                const datetime = new Date(`${date}T${time}Z`);
                const observer = new Astronomy.Observer(lat, lon, 0);

                celestialBodies.forEach(body => {
                    const row = document.querySelector(`tr[data-body-id="${body.id}"]`);
                    if (!row) return;

                    try {
                        const {ra, dec} = Astronomy.Equator(body.id, datetime, observer, true, true);
                        const {altitude, azimuth} = Astronomy.Horizon(datetime, observer, ra, dec, 'normal');
                        const distance = Astronomy.Equator(body.id, datetime, observer, true, true).dist;

                        // Calculate rise/set times
                        const rise = this.calculateRiseSet(body.id, observer, datetime, +1);
                        const set = this.calculateRiseSet(body.id, observer, datetime, -1);

                        // Update table cells
                        row.querySelector('.status').textContent = altitude > 0 ? 'Gökyüzünde' : 'Ufkun altında';
                        row.querySelector('.altitude').textContent = `${altitude.toFixed(1)}°`;
                        row.querySelector('.azimuth').textContent = `${azimuth.toFixed(1)}°`;
                        row.querySelector('.rise-time').textContent = rise ? this.formatTime(rise) : '-';
                        row.querySelector('.set-time').textContent = set ? this.formatTime(set) : '-';
                        row.querySelector('.distance').textContent = distance ? `${distance.toFixed(3)} AU` : '-';

                        // Special handling for Moon
                        if (body.id === 'Moon') {
                            const phase = getMoonPhase(datetime);
                            row.querySelector('.status').innerHTML =
                                `${altitude > 0 ? 'Gökyüzünde' : 'Ufkun altında'} <br><small>${phase.name}</small>`;
                        }
                    } catch (e) {
                        console.error(`Error calculating position for ${body.id}:`, e);
                        row.querySelector('.status').textContent = 'Hesaplama hatası';
                    }
                });

                // Update fixed stars
                fixedStars.forEach(star => {
                    const row = document.querySelector(`tr[data-body-id="${star.id}"]`);
                    if (!row) return;

                    try {
                        const {altitude, azimuth} = Astronomy.Horizon(datetime, observer, star.ra, star.dec, 'normal');

                        row.querySelector('.status').textContent = altitude > 0 ? 'Gökyüzünde' : 'Ufkun altında';
                        row.querySelector('.altitude').textContent = `${altitude.toFixed(1)}°`;
                        row.querySelector('.azimuth').textContent = `${azimuth.toFixed(1)}°`;
                        row.querySelector('.rise-time').textContent = '-';
                        row.querySelector('.set-time').textContent = '-';
                        row.querySelector('.distance').textContent = 'Sabit';
                    } catch (e) {
                        console.error(`Error calculating position for ${star.id}:`, e);
                        row.querySelector('.status').textContent = 'Hesaplama hatası';
                    }
                });
            },

            calculateRiseSet(bodyId, observer, date, direction) {
                try {
                    const time = Astronomy.SearchRiseSet(bodyId, observer, direction, date, 300);
                    return time ? new Date(time) : null;
                } catch (e) {
                    console.error(`Error calculating rise/set for ${bodyId}:`, e);
                    return null;
                }
            },

            formatTime(date) {
                if (!date || typeof date.toLocaleTimeString !== 'function') {
                    return '-';
                }
                return date.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});
            },

            updateTimeFromSlider() {
                const slider = document.getElementById('time-slider');
                const totalSeconds = parseInt(slider.value);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;

                document.getElementById('time').value = timeStr;
                document.getElementById('current-time-display').textContent = timeStr;
                this.updateCelestialPositions();
            },

            updateCelestialPositions() {
                const date = document.getElementById('date').value;
                const time = document.getElementById('time').value;
                const lat = parseFloat(document.getElementById('latitude').value);
                const lon = parseFloat(document.getElementById('longitude').value);

                // Gezegenler
                celestialBodies.forEach(body => {
                    const element = document.getElementById(body.id);
                    if (!element) return;

                    const pos = this.calculatePosition(body.id, date, time, lat, lon);
                    if (!pos) return;

                    // Düz dünya modeli için koordinat dönüşümü
                    const x = 50 + (pos.azimuth - 180) * 0.2;
                    const y = 70 - pos.altitude * 0.7;
                    element.style.left = `${Math.max(0, Math.min(100, x))}%`;
                    element.style.top = `${Math.max(0, Math.min(100, y))}%`;

                    const info = element.querySelector('.celestial-info');
                    if (info) {
                        info.innerHTML = `<strong>${body.name}</strong><br>Yükseklik: ${pos.altitude.toFixed(1)}°<br>Açı: ${pos.azimuth.toFixed(1)}°${pos.distance ? `<br>Mesafe: ${pos.distance.toFixed(3)} AU` : ''}`;
                    }
                });

                // Sabit yıldızlar
                fixedStars.forEach(star => {
                    const element = document.getElementById(star.id);
                    if (!element) return;

                    const pos = this.calculatePosition(star.id, date, time, lat, lon);
                    if (!pos) return;

                    const x = 50 + (pos.azimuth - 180) * 0.2;
                    const y = 70 - pos.altitude * 0.7;
                    element.style.left = `${Math.max(0, Math.min(100, x))}%`;
                    element.style.top = `${Math.max(0, Math.min(100, y))}%`;

                    const info = element.querySelector('.celestial-info');
                    if (info) {
                        info.innerHTML = `<strong>${star.name}</strong><br>Yükseklik: ${pos.altitude.toFixed(1)}°<br>Açı: ${pos.azimuth.toFixed(1)}°`;
                    }
                });

                const hours = parseInt(document.getElementById('time').value.split(':')[0]);
                const minutes = parseInt(document.getElementById('time').value.split(':')[1]);
                updateDayNightSegments(hours, minutes);
            },

            updateAll() {
                this.updateCelestialTable();
                this.updateCelestialPositions();
            }
        };

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                createStars();
                CelestialTracker.init();
            }, 100);
        });

        function createStars() {
            const container = document.getElementById('celestial-display');
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 50 + 10}%`;
                star.style.width = `${Math.random() * 2 + 0.5}px`;
                star.style.height = star.style.width;
                star.style.opacity = Math.random() * 0.7 + 0.3;
                star.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(star);
            }
        }

        function createCelestialBodies() {
            const container = document.getElementById('celestial-display');

            // Gezegenler
            celestialBodies.forEach(body => {
                const element = document.createElement('div');
                element.id = body.id;
                element.className = 'celestial-body';
                element.style.width = `${body.size}px`;
                element.style.height = `${body.size}px`;
                element.style.background = body.color;
                element.style.boxShadow = `0 0 20px ${body.color}`;

                const info = document.createElement('div');
                info.className = 'celestial-info';
                info.innerHTML = `<strong>${body.name}</strong><br>Yükseklik: 0°<br>Açı: 0°`;
                element.appendChild(info);

                container.appendChild(element);
            });

            // Sabit yıldızlar
            fixedStars.forEach(star => {
                const element = document.createElement('div');
                element.id = star.id;
                element.className = 'celestial-body';
                element.style.width = `${star.size}px`;
                element.style.height = `${star.size}px`;
                element.style.background = star.color;
                element.style.boxShadow = `0 0 20px ${star.color}`;

                const info = document.createElement('div');
                info.className = 'celestial-info';
                info.innerHTML = `<strong>${star.name}</strong><br>Yükseklik: 0°<br>Açı: 0°`;
                element.appendChild(info);

                container.appendChild(element);
            });
        }

        function updateDayNightSegments(hours, minutes) {
            const daySegment = document.querySelector('.day-segment .segment-value');
            const nightSegment = document.querySelector('.night-segment .segment-value');

            if (hours >= 6 && hours < 18) {
                const segment = Math.floor(((hours - 6) * 60 + minutes) / 180) + 1;
                daySegment.textContent = `${segment}. Dilim`;
                nightSegment.textContent = '-';
            } else {
                daySegment.textContent = '-';
                let hour = hours < 6 ? hours + 24 : hours;
                const segment = Math.floor(((hour - 18) * 60 + minutes) / 180) + 1;
                nightSegment.textContent = `${segment}. Dilim`;
            }
        }
    </script>
</body>
</html>